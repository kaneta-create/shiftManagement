import{a as I,r as $,w as g,k as E,o as n,c as i,i as r,l as N,e as o,t as _,F as f,g as k,v as h,m as v,n as D,u as w,h as T}from"./app-8b9ecc7e.js";import"./index-bfccac7f.js";const Y={class:"modal",id:"modal-1"},A={class:"modal__overlay",tabindex:"-1","data-micromodal-close":""},j={class:"bg-white w-2/5 p-8 rounded-lg shadow-sm items-center",role:"dialog","aria-modal":"true","aria-labelledby":"modal-1-title"},B=o("header",{class:""},[o("h2",{class:"text-2xl font-bold text-center border-b pb-2 text-indigo-600",id:"modal-1-title"}," シフト変更 ")],-1),H={class:"modal__content",id:"modal-1-content"},J={class:"flex flex-col space-y-4"},z={class:"mb-4"},L={class:"text-center text-lg"},R={class:"flex items-center"},q=o("label",{for:"employee_name",class:"text-gray-700 text-nowrap w-1/3 text-center"},"従業員名 ：",-1),F=o("option",{value:"",disabled:""},"選択",-1),G=["value"],K={class:"flex items-center"},P=o("label",{class:"text-gray-700 text-nowrap w-1/4 text-center ml-1"},"出勤 / 休日 ：",-1),Q={class:"ml-1 w-full flex justify-around"},W={class:"flex items-center"},X=o("span",{class:"mr-4"},"出勤",-1),Z={class:"flex items-center"},ee=o("span",null,"休日",-1),te={class:"flex items-center"},oe=o("label",{for:"clock_in",class:"text-gray-700 text-nowrap w-1/3 text-center"},"出勤時間 ：",-1),se=["disabled"],le=o("option",{value:"",disabled:""},"選択",-1),ae=["value"],ne={class:"flex items-center"},ie=o("label",{for:"clock_out",class:"text-gray-700 text-nowrap w-1/3 text-center"},"退勤時間 ：",-1),ce=["disabled"],de=o("option",{value:"",disabled:""},"選択",-1),re=["value"],_e={key:0,class:"text-red-500 text-sm"},pe={__name:"CreateShiftModal",props:{date:String,full_date:String,Ymd_date:String,userId:Number,shifts:Array,employeeInfo:Array,day_of_week:String},emits:["updateShiftData"],setup(O,{emit:S}){const m=I(!1),p=()=>{m.value=!m.value},a=O,d=a.shifts.filter(l=>l.full_date==a.Ymd_date&&l.employee_id==a.userId&&l.clock_in!=l.clock_out);function b(l){if(l==2400)return"24:00";{const s=String(Math.floor(l/100)).padStart(2,"0"),t=String(l%100).padStart(2,"0");return`${s}:${t}`}}let c=[];d.length>0?(d[0].clock_out==2400&&(d[0].clock_out=2359),c=[{clock_in:b(d[0].clock_in),clock_out:b(d[0].clock_out),full_date:d[0].full_date,isDayOff:"0"}]):c=[{clock_in:null,clock_out:null,isDayOff:""}];const e=$({isDayOff:c[0].isDayOff?"0":"1",clock_in:c[0].clock_in?c[0].clock_in:"",clock_out:c[0].clock_out?c[0].clock_out:"",date:"",employee_name:"",employee_id:""});g(()=>e.employee_name,l=>{const s=a.employeeInfo.find(t=>t.employee_name===l);s&&(e.employee_id=s.employee_id)}),E(()=>{e.date=a.Ymd_date}),g(()=>a.Ymd_date,l=>{e.date=l}),g(e,l=>{Object.keys(l).forEach(s=>{const t=l[s].start_time,u=l[s].end_time;t&&u&&t>=u&&console.error(`${s} の出勤時間は退勤時間より前に設定してください。`)})});const C=S,y=[],M=()=>{if(e.isDayOff===""){console.error("出勤か休日のいずれかを選択してください。"),alert("出勤か休日のいずれかを選択してください。");return}if(e.employee_name==""){alert("従業員を選択してください。");return}if(e.isDayOff==0&&e.clock_in==""){alert("出勤時間を入力してください");return}else if(e.isDayOff==0&&e.clock_out==""){alert("退勤時間を入力してください");return}if(y.some(t=>t.date===e.date&&t.employee_name==e.employee_name)){alert("既に入力済みです。");return}let s={isDayOff:e.isDayOff,clock_in:e.clock_in,clock_out:e.clock_out,date:e.date,employee_id:e.employee_id,employee_name:e.employee_name};y.push(JSON.parse(JSON.stringify(s))),p(),C("updateShiftData",y)},x=(()=>{const l=[];for(let s=0;s<24;s++)for(let t=0;t<60;t+=15){const u=String(s).padStart(2,"0"),V=String(t).padStart(2,"0");l.push(`${u}:${V}`)}return l.push("23:59"),l})(),U=()=>{alert("変更できるのは今日以降のみです。")};return(l,s)=>(n(),i(f,null,[r(o("div",Y,[o("div",A,[o("div",j,[B,o("main",H,[o("div",J,[o("div",z,[o("p",L,_(a.full_date)+" ("+_(a.day_of_week)+"曜日)",1)]),o("div",R,[q,r(o("select",{id:"employee_name",name:"employee_name","onUpdate:modelValue":s[0]||(s[0]=t=>e.employee_name=t),class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"},[F,(n(!0),i(f,null,k(a.employeeInfo,t=>(n(),i("option",{key:t.employee_id,value:t.employee_name},_(t.employee_name),9,G))),128))],512),[[h,e.employee_name]])]),o("div",K,[P,o("div",Q,[o("div",W,[r(o("input",{name:"isDayOff",type:"radio",value:"0","onUpdate:modelValue":s[1]||(s[1]=t=>e.isDayOff=t),class:"mr-1"},null,512),[[v,e.isDayOff]]),X]),o("div",Z,[r(o("input",{name:"isDayOff",type:"radio",value:"1","onUpdate:modelValue":s[2]||(s[2]=t=>e.isDayOff=t),class:"mr-1"},null,512),[[v,e.isDayOff]]),ee])])]),o("div",te,[oe,r(o("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>e.clock_in=t),disabled:e.isDayOff==="1",class:D([{"bg-gray-200":e.isDayOff==="1","cursor-not-allowed":e.isDayOff==="1"},"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"]),id:"clock_in"},[le,(n(!0),i(f,null,k(w(x),t=>(n(),i("option",{key:t,value:t},_(t),9,ae))),128))],10,se),[[h,e.clock_in]])]),o("div",ne,[ie,r(o("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>e.clock_out=t),disabled:e.isDayOff==="1",class:D([{"bg-gray-200":e.isDayOff==="1","cursor-not-allowed":e.isDayOff==="1"},"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"]),id:"clock_out"},[de,(n(!0),i(f,null,k(w(x),t=>(n(),i("option",{key:t,value:t},_(t),9,re))),128))],10,ce),[[h,e.clock_out]])]),e.clock_in&&e.clock_out&&e.clock_in>=e.clock_out?(n(),i("div",_e," 出勤時間は退勤時間より前に設定してください。 ")):T("",!0)])]),o("footer",{class:"modal__footer mt-4"},[o("div",{class:"flex justify-between"},[o("button",{onClick:p,type:"button",class:"modal__btn","data-micromodal-close":"","aria-label":"Close this dialog window"},"閉じる"),o("button",{type:"button",onClick:M,class:"text-white bg-indigo-600 border-0 text-sm px-4 py-3 focus:outline-none hover:bg-indigo-700 rounded"},"保存")])])])])],512),[[N,m.value]]),o("td",null,[o("button",{onClick:s[5]||(s[5]=t=>new Date(a.Ymd_date)>=new Date().setHours(0,0,0,0)?p():U()),class:"text-center",type:"button"},_(a.date),1)])],64))}};export{pe as _};
